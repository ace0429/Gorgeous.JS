/*
 * Gorgeous.JS v0.1.0 2015-05-31
 * author: chen-an@outlook.com 
 */
var gorgeous={};!function(a){function b(a,b,c){var d=a-b,e=a-c,f=b-c,g=Math.acos(.5*(d+e)/(Math.sqrt(d*d+e*f)+1e-5));return Math.round(255*(b>=c?g:2*Math.PI-g)/(2*Math.PI))}function c(a,b,c){var d=Math.min(a,b,c);return Math.round(255*(1-3*d/(a+b+c+1e-5)))}function d(a,b,c){return Math.round((a+b+c)/3)}a.loadImage=function(a,b){var c=new Image;return c.onload=function(a){b(c,a)},c.src=a,c},a.makeCanvasContext=function(a,b){if(!a||!b||0>a||0>b)throw new Error("Canvas width & height must be positive.");var c=document.createElement("canvas");return c.width=a,c.height=b,c.getContext("2d")},a.init=function(b,c,d){c=c||1,d=d||1,b.ctx=a.makeCanvasContext(c,d),b.width=c,b.height=d,b.nativeImageData=b.ctx.getImageData(0,0,c,d),b.data=b.nativeImageData.data,b.hsiData=null,b.__synchronized=!1},a.intensity=function(a,b,c){return d(a,b,c)},a.rgb2hsi=function(a,e,f){return{h:b(a,e,f),s:c(a,e,f),i:d(a,e,f)}},a.hsi2rgb=function(a,b,c){function d(a,b){return b*(1-a)}function e(a,b,c){return c*(1+b*Math.cos(a)/Math.cos(Math.PI/3-a))}function f(a,b,c){return 3*a-b-c}var g,h,i,j,k,l,m=120*Math.PI/180,n=240*Math.PI/180;return g=a/255*2*Math.PI,h=b/255,i=c,g>n?(g-=n,k=d(h,i),l=e(g,h,i),j=f(i,k,l)):g>m?(g-=m,j=d(h,i),k=e(g,h,i),l=f(i,k,j)):(l=d(h,i),j=e(g,h,i),k=f(i,j,l)),{r:Math.round(j),g:Math.round(k),b:Math.round(l)}}}(gorgeous),function(a){"use strict";function b(a,b,c){a.width=b,a.height=c,a.ctx.canvas.width=b,a.ctx.canvas.height=c}function c(a,b){d(a,b.getContext("2d"))}function d(a,b){h(a,b.getImageData(0,0,b.canvas.width,b.canvas.height))}function e(a,b,c){var d=new Image;d.onload=function(){f(a,d),"function"==typeof c&&c(a)},d.src=b}function f(a,c){var d=a.ctx;b(a,c.width,c.height),d.drawImage(c,0,0,c.width,c.height),a.pullChange()}function g(a,c){var d=a.ctx;b(a,c.width,c.height),d.putImageData(c.nativeImageData,0,0),a.pullChange()}function h(a,c){var d=a.ctx;b(a,c.width,c.height),d.putImageData(c,0,0),a.pullChange()}a.ImageData=function(b,i){if(!(this instanceof a.ImageData))return new a.ImageData(b,i);if(a.init(this),b instanceof Image)f(this,b);else if("string"==typeof b)e(this,b,i);else if(b instanceof HTMLCanvasElement)c(this,b);else if(b instanceof CanvasRenderingContext2D)d(this,b);else if(b instanceof a.ImageData)g(this,b);else{if(!(b instanceof ImageData))throw new Error("Need a source to create g.ImageData.");h(this,b)}},a.ImageData.prototype.toString=function(){return"[object g.ImageData] with width: "+this.width+"px, height: "+this.height+"px"},a.ImageData.prototype.getDataURL=function(){return this.ctx.canvas.toDataURL()},a.ImageData.prototype.getImage=function(a){var b=new Image;return b.onload=function(){"function"==typeof a&&a(b)},b.src=this.getDataURL(),b},a.ImageData.prototype.pushChange=function(){return this.ctx.putImageData(this.nativeImageData,0,0),this.__synchronized=!1,this},a.ImageData.prototype.pullChange=function(){return this.nativeImageData=this.ctx.getImageData(0,0,this.width,this.height),this.data=this.nativeImageData.data,this.__synchronized=!1,this}}(gorgeous),function(a){function b(b,c,d){d&&!b.__synchronized&&b.updateHSI();var e=b.hsiData,f=new a.ImageData(b),g=f.data;if(!(c instanceof Function))throw new Error("need operations.");for(var h=0;h<g.length;h+=4)c(h,g,e);return f.ctx.putImageData(f.nativeImageData,0,0),f}a.ImageData.prototype.updateHSI=function(){var b=this.data.length,c=this.data;this.hsiData||(this.hsiData=new Uint8ClampedArray(b));for(var d=this.hsiData,e=0;b>e;e+=4){var f=a.rgb2hsi(c[e],c[e+1],c[e+2]);d[e]=f.h,d[e+1]=f.s,d[e+2]=f.i,d[e+3]=c[e+3]}return this.__synchronized=!0,this},a.ImageData.prototype.updateRGB=function(){if(!this.hsiData)throw new Error("There is no hsiData field yet.");for(var b=this.data.length,c=this.data,d=this.hsiData,e=0;b>e;e+=4){var f=a.hsi2rgb(d[e],d[e+1],d[e+2]);c[e]=f.r,c[e+1]=f.g,c[e+2]=f.b,c[e+3]=d[e+3]}return this.pushChange(),this.__synchronized=!0,this},a.ImageData.prototype.getR=function(){return b(this,function(a,b){b[a+1]=b[a+2]=0},!1)},a.ImageData.prototype.getG=function(){return b(this,function(a,b){b[a]=b[a+2]=0},!1)},a.ImageData.prototype.getB=function(){return b(this,function(a,b){b[a]=b[a+1]=0},!1)},a.ImageData.prototype.getH=function(){var a=b(this,function(a,b,c){b[a]=b[a+1]=b[a+2]=c[a]},!0);return this.__synchronized=!0,a},a.ImageData.prototype.getS=function(){var a=b(this,function(a,b,c){b[a]=b[a+1]=b[a+2]=c[a+1]},!0);return this.__synchronized=!0,a},a.ImageData.prototype.getI=function(){var a=b(this,function(a,b,c){b[a]=b[a+1]=b[a+2]=c[a+2]},!0);return this.__synchronized=!0,a},a.ImageData.prototype.getHSI=function(){var a=b(this,function(a,b,c){for(var d=0;4>d;d++)b[a+d]=c[a+d]},!0);return this.__synchronized=!0,a}}(gorgeous),function(a){function b(a,b,c,d,e,f){return a=a||0,b=b||0,c=c||e-a,d=d||f-b,0>a||a>e||0>b||b>f||c+a>e||0>c||d+b>f||0>d?!1:[a,b,a+c,b+d]}function c(a,c,d,e,f,g,h){var i=b(c,d,e,f,a.width,a.height);if(!i)throw new Error("range error");c=i[0],d=i[1];for(var j=i[2],k=i[3],l=[],m=c;j>m;m++)l[m]=[];var n;h?(a.hsiData||a.updateHSI(),n=a.hsiData):n=a.data;for(var o=d;k>o;o++)for(var p=c;j>p;p++){l[p][o]={};var q=4*(o*a.width+p);g(l[p][o],n,q)}return l.left=c,l.top=d,l.width=e,l.height=f,l.right=j,l.bottom=k,l.each=function(a){for(var b=this.top;b<this.bottom;b++)for(var c=this.left;c<this.right;c++)a(this[c][b],c,b);return this},l.every=function(a,b){if(!(a instanceof Function))return!1;for(var c=this.top;c<this.bottom;c++)for(var d=this.left;d<this.right;d++)if(!a(this[d][c],d,c))return b instanceof Function&&b(this[d][c],d,c),!1;return!0},l}function d(a,b,c,d){var e;d?(a.hsiData||(a.hsiData=new Uint8ClampedArray(a.data.length)),e=a.hsiData):e=a.data;for(var f=b.top;f<b.bottom;f++)for(var g=b.left;g<b.right;g++){var h=4*(f*a.width+g);c(b[g][f],e,h)}d?a.updateRGB():a.pushChange()}a.ImageData.prototype.getPixels=function(a,b,d,e){return c(this,a,b,d,e,function(a,b,c){a.r=b[c],a.g=b[c+1],a.b=b[c+2],a.a=b[c+3]},!1)},a.ImageData.prototype.setPixels=function(a){return d(this,a,function(a,b,c){b[c]=a.r,b[c+1]=a.g,b[c+2]=a.b,b[c+3]=a.a},!1),this},a.ImageData.prototype.getHSIPixels=function(a,b,d,e){var f=c(this,a,b,d,e,function(a,b,c){a.h=b[c],a.s=b[c+1],a.i=b[c+2],a.a=b[c+3]},!0);return this.__synchronized=!0,f},a.ImageData.prototype.setHSIPixels=function(a){return d(this,a,function(a,b,c){b[c]=a.h,b[c+1]=a.s,b[c+2]=a.i,b[c+3]=a.a},!0),this.__synchronized=!0,this}}(gorgeous),function(a){function b(a,b){for(var c=0;c<a.data.length;c+=4)for(var d=0;3>d;d++)b(a.data,c+d);return a.pushChange(),a}a.ImageData.prototype.gray=function(){for(var b=this.data,c=0;c<b.length;c+=4)b[c]=b[c+1]=b[c+2]=a.intensity(b[c],b[c+1],b[c+2]);return this.pushChange(),this},a.ImageData.prototype.threshold=function(){for(var b=this.data,c=0,d=0;d<b.length;d+=4)(b[d]!==b[d+1]||b[d+1]!==b[d+2])&&(b[d]=b[d+1]=b[d+2]=a.intensity(b[d],b[d+1],b[d+2])),c+=b[d];c/=this.width*this.height;for(var d=0;d<b.length;d+=4)b[d]>c?b[d]=b[d+1]=b[d+2]=255:b[d]=b[d+1]=b[d+2]=0;return this.pushChange(),this},a.ImageData.prototype.negative=function(){return b(this,function(a,b){a[b]=255-a[b]})},a.ImageData.prototype.log=function(a){if(1>a||a>5)throw new Error("log() need argument n greater than 1 & less than 5.");var c=255/Math.log(256);return b(this,function(a,b){a[b]=Math.log(a[b]+1)*c})},a.ImageData.prototype.exp=function(a){if(1>a||a>5)throw new Error("exp() need argument n greater than 1 & less than 5.");a=1+a/20;var c=255/(Math.pow(a,255)-1);return b(this,function(b,d){b[d]=(Math.pow(a,b[d])-1)*c})},a.ImageData.prototype.root=function(a){if(1>a||a>5)throw new Error("root() need argument n greater than 1 & less than 5.");var c=1/a,d=255/Math.pow(255,c);return b(this,function(a,b){a[b]=Math.pow(a[b],c)*d})},a.ImageData.prototype.pow=function(a){if(1>a||a>5)throw new Error("pow() need argument n greater than 1 & less than 5.");var c=255/Math.pow(255,a);return b(this,function(b,d){b[d]=Math.pow(b[d],a)*c})}}(gorgeous),function(a){a.ImageData.prototype.histogram=function(){this.__synchronized||this.updateHSI();for(var a=this.hsiData,b=new Array(256),c=0;256>c;c++)b[c]=0;for(var d=1/(this.width*this.height),c=0;c<a.length;c+=4)b[a[c+2]]+=1;for(var c=0;256>c;c++)b[c]*=d;return this.__synchronized=!0,b},a.ImageData.prototype.equalize=function(){for(var a=new Uint8ClampedArray(256),b=this.histogram(),c=0,d=0;256>d;d++)c+=b[d],a[d]=255*c;for(var e=this.hsiData,d=0;d<e.length;d+=4)e[d+2]=a[e[d+2]];return this.updateRGB(),this.__synchronized=!0,this}}(gorgeous),function(a){"use strict";function b(a){return a.trim().replace(/\s+/g," ").toLowerCase()}a.makeKernel=function(a,b,c){if(!a)return null;var d=a.slice().map(function(a){return a*(b||1)});if(d.n=Math.floor(Math.sqrt(d.length)),d.mid=Math.round(d.n/2)-1,d.n*d.n!==d.length)throw new Error("kernel size mismatch.");return d.bias=c||0,d.get=function(a,b){return d[b*d.n+a]},d},a.convolution=function(a,b,c,d){for(var e=new Uint8ClampedArray(a),f=0;c>f;f++)for(var g=0;b>g;g++){for(var h=[0,0,0],i=0;i<d.length;i++){var j=Math.floor(i/d.n)-d.mid+f,k=i%d.n-d.mid+g;if(!(0>k||0>j||k>=b||j>=c))for(var l=4*(b*j+k),m=0;3>m;m++)h[m]+=d[i]*e[l+m]}for(var n=4*(b*f+g),m=0;3>m;m++)a[n+m]=h[m]+d.bias}return a},a.kernels={},a.register=function(c,d,e,f){if(c=b(c),"string"==typeof d){if(d=b(d),!a.kernels[d]){if(!a.ImageData.prototypep[d])throw new Error("no "+d+" in g.kernels.");a.kernels[c]=function(){a.ImageData.prototype[d].apply(this,Array.prototype.slice.call(this,2))}}a.kernels[c]=a.kernels[d]}else d instanceof Function?a.kernels[c]=d:d instanceof Array&&"string"==typeof d[0]?a.kernels[c]=function(a){return function(){for(var b=0;b<a.length;b++)this.use.apply(this,a[b])}}(Array.prototype.slice.call(arguments,1)):a.kernels[c]=a.makeKernel(d,e,f);return a},a.ImageData.prototype.use=function(c){c=b(c);var d=a.kernels[c];if(d instanceof Function)d.apply(this,Array.prototype.slice.call(arguments,1)),this.pushChange();else if(d instanceof Array&&"number"==typeof d[0])a.convolution(this.data,this.width,this.height,d),this.pushChange();else{if(!(this[c]instanceof Function))throw new Error("no such filter.");this[c].apply(this,Array.prototype.slice.call(arguments,1))}return this}}(gorgeous),function(a){a.register("Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0],1/13),a.register("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1],1/256),a.register("Mean",[1,1,1,1,1,1,1,1,1]),a.register("Middle",function(a,b){function c(a,b){return a-b}a=a||3,b=b||3;var d=new Uint8ClampedArray(this.data),e=[],f=a*b,g=Math.round(b/2)-1,h=Math.round(a/2)-1;f%2===0?(e.push(f/2-1),e.push(f/2)):e.push((f-1)/2);for(var i=0;i<this.height;i++)for(var j=0;j<this.width;j++){for(var k=4*(this.width*i+j),l=[[],[],[]],m=0;f>m;m++){var n=Math.floor(m/a)-g+i,o=m%a-h+j;if(0>o||0>n||o>=this.width||n>=this.height)for(var p=0;3>p;p++)l[p].push(0);else for(var q=4*(this.width*n+o),p=0;3>p;p++)l[p].push(d[q+p])}for(var p=0;3>p;p++){l[p].sort(c);for(var r=0,m=0;m<e.length;m++)r+=l[p][e[m]];this.data[k+p]=r/e.length}}})}(gorgeous),function(a){a.register("Sharpen",[-1,-1,-1,-1,9,-1,-1,-1,-1]),a.register("Excessive Sharpen",[1,1,1,1,-7,1,1,1,1])}(gorgeous),function(a){a.register("Emboss",[-1,-1,0,-1,0,1,0,1,1],1,128),a.register("Mosaic",function(a,b){a=a||6,b=b||6;for(var c=Math.round(b/2)-1,d=Math.round(a/2)-1,e=0;e<this.height;e+=b)for(var f=0;f<this.width;f+=a){for(var g=4*((e+c)*this.width+(f+d)),h=[],i=0;3>i;i++)h.push(this.data[g+i]);for(var j=0;b>j;j++)for(var k=0;a>k;k++)if(k<this.width&&j<this.height)for(var l=4*((e+j)*this.width+(f+k)),i=0;3>i;i++)this.data[l+i]=h[i]}})}(gorgeous);